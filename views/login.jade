doctype html
html(lang='ko-kr')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title Vasket!
    // Bootstrap
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    link(href='/bootstrap/css/kfonts2.css', rel='stylesheet')
    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
      script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
      script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
    style(type='text/css').
      body {
      padding-top: 70px;
      background-color: #ffa800;
      }
      #aa {
      border-radius: 20px;
      background-color: white;
      text-align: center;
      }
      #pwd {
      margin-top: 4px;
      margin-bottom: 4px;
      }
      button {
      margin-bottom: 4px;
      margin-top: 4px;
      width: 92%;
      height: 40px;
      }
      input.btn {
      width: 92%;
      height: 35px;
      background-color: #ffa800;
      }
      input.form-control {
      width: 92%;
      }
      .none-prop {width: 0%;}
  body
    script.
      // This is called with the results from from FB.getLoginStatus().
      // This function is called when someone finishes with the Login
      // Button.  See the onlogin handler attached to it in the sample
      // code below.
      window.fbAsyncInit = function() {
      FB.init({
      appId      : 883225935107427,
      cookie     : true,  // enable cookies to allow the server to access
      // the session
      xfbml      : true,  // parse social plugins on this page
      version    : 'v2.5' // use version 2.2
      });
      // Now that we've initialized the JavaScript SDK, we call
      // FB.getLoginStatus().  This function gets the state of the
      // person visiting this page and can return one of three states to
      // the callback you provide.  They can be:
      //
      // 1. Logged into your app ('connected')
      // 2. Logged into Facebook, but not your app ('not_authorized')
      // 3. Not logged into Facebook and can't tell if they are logged into
      //    your app or not.
      //
      // These three cases are handled in the callback function.
      };

      function go_signup(){
        FB.getLoginStatus(function(response) {
          if (response.status == 'connected') {
            FB.api(
              '/me',
              'GET',
              {"fields":"id,name,birthday,gender,email"},
              function(response) {
                $.ajax({
                  type: 'POST',
                  data: response, 
                  dataType: "JSON",
                  url: '/fb_login',
                  success: function(data) {
                    var form = document.createElement('form');
                    form.setAttribute('method', 'post');
                    form.setAttribute('action', '/signup');
                    for (var key in data) {
                      var hiddenField = document.createElement("input");
                      hiddenField.setAttribute("type", "hidden");
                      hiddenField.setAttribute("name", key);
                      hiddenField.setAttribute("value", data[key]);
                      form.appendChild(hiddenField);
                    }
                    document.body.appendChild(form);
                    form.submit();
                  },
                  error: function(request, status, error) {
                    window.location.href='/';
                  }
                });
              }
            );
          }
        });
      }

      function fb_login(){
      FB.login(function(response) {
      if (response.authResponse) {
        go_signup();
      } else {
        alert('^6^');
        location.href = '/';
      }
      }, {
      scope: 'public_profile,email,user_likes,user_birthday'
      });
      }

      // Load the SDK asynchronously
      (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
      // Here we run a very simple test of the Graph API after login is
      // successful.  See statusChangeCallback() for when this call is made.
    .container-fluid
      center
        a(href='/')
          img(src='/images/login_logo.png')
      br
      br
      br
      #aa.col-sm-offset-4.col-sm-4
        br
        br
        .col-sm-12
          h3 로그인
          p 로그인 하실 계정을 선택해주세요
          //hr
          //form.form-horizontal(role='form', action='login_check', method='post')
            .col-sm-12
              center
                input.form-control(type='text', name='id', placeholder='facebook 아이디', size='45')
            .col-sm-12
              center
                input#pwd.form-control(type='password', name='pw', placeholder='Enter password', size='45')
            .col-sm-12
              input.btn.btn-default(type='submit', value='로그인', size='45')
          .col-sm-12
            //hr
            button.btn.btn-default(onClick='fb_login();') 페이스북으로 로그인
          .col-sm-12
            button.btn.btn-default 다른 SNS 회원가입은 준비중입니다.
            hr
          //.col-sm-12
            p
              | 아직 가입 안하셨나요? 
              a(href='signup') 회원가입
        br
        br
      .col-sm-4.none-prop
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js')
    script(src='/bootstrap/js/bootstrap.min.js')