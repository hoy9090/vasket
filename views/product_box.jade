doctype html
html
  head
    meta(charset='UTF-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title Vasket!
    link(rel='stylesheet', href='/bootstrap/css/bootstrap.min.css')
    link(rel='stylesheet', href='/bootstrap/css/bootstrap-theme.min.css')
    link(href='/bootstrap/css/kfonts2.css', rel='stylesheet')
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
      script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
      script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
    style(type='text/css').
      body {background-color: #f6f6f6; padding-bottom: 20px;}
      #nav {background-color: #ffffff; padding-top: 7px; padding-left: 10px; padding-bottom: 7px; text-align: center;border-width:0px; border-bottom-width: 1px; border-color: #bbbbbb; border-style: solid; z-index: 1;}
      #nav span {float: left; font-size: 20px; padding-top: 9px; color:black;}
      #nav h4 {float: clear; padding-right: 15px;}
      #contentBox { margin-top:10px;}
      .carousel-inner > .item > img,
      .carousel-inner > .item > a > img { width:100%; margin:auto;}
      .carousel-control.left, .carousel-control.right {background-image:none;}
      #likeBlock {background-color:#eaeaea; text-align:center; width:100%; padding-top:5px;}
      #contentBlock {background-color:#ffffff; width:100%;border-width:0px; border-style:solid; border-color:#bbbbbb; border-bottom-width:1px; border-top-width:1px; padding-top:20px; padding-bottom:10px;}
      #community {background-color: #ffa800; text-align:center; border-style:solid; border-color:#ffa800; border-width:2px; color: #ffffff;}
      #productInfo {background-color: #ffffff; text-align:center; border-style:solid; border-color:#ffa800; border-width:2px; border-left-width:0px; color:#ffa800;}
      #community-con {display:block; padding-top: 15px;}
      #info-con {display:none; background-color:#ffffff; border-color:#bbbbbb; border-width:1px; border-style:solid; width:100%; padding-top:10px;}
      #tr1{padding-bottom:5px; padding-top:5px; border-style:solid; border-color:#bbbbbb; border-width:0px; border-top-width:2px;}
      #tr2 {padding-bottom:5px; padding-top:5px; border-style:solid; border-color:#bbbbbb; border-width:0px; border-top-width:2px; border-bottom-width:2px;}
      table {width:100%;}
      table tr td, table tr th {padding-bottom:5px; padding-top:5px;}
      table tr th {text-align:center; width:30%;}
      #starAvg {width:100%; background-color:#ffffff; margin-bottom: 15px; padding-top: 10px;}
      #heart {width:100%; background-color:#ffffff; margin-bottom:15px;}
      #heartSection {padding-top:10px;}
      #commentBlock {background-color:#ffffff; width: 100%; padding-top: 3px; padding-bottom: 3px; border-width:0px; border-style:solid; border-color:#bbbbbb; border-bottom-width:1px;}
      #commentInput {width: 100%; position: relative; height: 45px; padding: 0;}
      #comment {width: 100%; padding: 0px;padding-top: 3px; padding-bottom: 3px; }
      #commentField {width: 85%; resize: none; height: 45px;}
      #commentBtn {width: 15%; padding: 0; height: 45px; top: 0; position: absolute; border-radius: 0;}
      #like, #clip {z-index: 1; cursor: pointer;}
      #star-bg {width: 150px; height: 30px; position: absolute; top: 0; left: 0; right: 0; margin-left: auto; margin-right: auto; padding-top: 10px;}
      #red-bg {height: 30px; background-color: #F00; float: left;}
      #white-bg {height: 30px; background-color: #FFF; float: right;}
      #star-5 {text-align: center; }
  body
    #nav.col-xs-12
      a(href='javascript:history.back()')
        span.glyphicon.glyphicon-arrow-left
      h4.bold 상품
    #myCarousel.carousel.slide(data-ride="carousel")
      ol.carousel-indicators(style="margin-bottom:-10px;")
        li.active(data-target="#myCarousel" data-slide-to="0")
        - for (var i=1; i<product.imageCount; i++) {
          li(data-target="#myCarousel" data-slide-to="#{i}")
        - }
      .carousel-inner(role="listbox")
        .item.active
          img(src="/images/products/#{product.image}/0")
        - for (var i=1; i<product.imageCount; i++) {
          .item
            img(src="/images/products/#{product.image}/#{i}")
        - }
      a.left.carousel-control(href="#myCarousel" role="button" data-slide="prev" style="margin-top:40px;").
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="false"></span>
        <span class="sr-only">Previous</span>
      a.right.carousel-control(href="#myCarousel" role="button" data-slide="next" style="margin-top:40px;").
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="false"></span>
        <span class="sr-only">Next</span>
    #contentBlock.col-xs-12
      p= product.content
    #likeBlock.col-xs-12
      .row
        .row
        if (loggedIn)
          .col-xs-2#like(onClick='like();')
            img#like_img(src=(product.user_like==1 ? './images/heart_on.png' : './images/heart.png') class=(product.user_like==1 ? 'like' : 'no_like') width='18px;')
            h6= product.like
        else
          .col-xs-2
            img(src='./images/heart.png' width='18px;')
            h6= product.like
        .col-xs-2
          img(src='./images/speech.png' width='18px;')
          h6= product.count
        if (loggedIn)
          .col-xs-2#clip(onClick='clip();')
            img#clip_img(src=(product.user_clip==1 ? './images/clip_on.png' : './images/clip.png') class=(product.user_clip==1 ? 'clip' : 'no_clip') width='18px;')
            h6= product.clip
        else
          .col-xs-2
            img(src='./images/clip.png' width='18px;')
            h6= product.clip
        .col-xs-offset-4.col-xs-2
          img(src='./images/view.png' width='18px;')
          h6= product.view
    #productBlock.col-xs-12
      .row
        #community.col-xs-6(onClick='change(1)')
          h6 커뮤니티
        #productInfo.col-xs-6(onClick='change(2)')
          h6 제품정보
    #community-con.col-xs-12
      #starAvg.col-xs-12
        #star-bg
          #red-bg
          #white-bg
          - var red_width = Math.round(star.star / 5 * 150);
          - $('#red-bg').css('height', red_width+"px");
          - $('#white-bg').css('height', (150-red_width)+"px");
        #star-5.col-xs-12
          img(src='./images/star_5.png' width='150px')
        .col-xs-12(style="text-align: center;")
          h5 평균 별점 #{star.star}
      if (loggedIn)
        #heart.col-xs-12
          .row
            #heartSection.col-xs-5
              span#h1(onClick='heart(1)')
                img(src='./images/star_on.png' width='18px')
              span#h2(onClick='heart(2)')
                img(src='./images/star_on.png' width='18px')
              span#h3(onClick='heart(3)')
                img(src='./images/star_on.png' width='18px')
              span#h4(onClick='heart(4)')
                img(src='./images/star_on.png' width='18px')
              span#h5(onClick='heart(5)')
                img(src='./images/star_on.png' width='18px')
            .col-xs-7
              h5#grade 별점을 선택하세요
      #commentBlock.col-xs-12
        if (loggedIn)
          #commentInput
            textarea#commentField(maxlength="70" placeholder="댓글을 입력하세요")
            button.btn.btn-warning#commentBtn(onClick="reg_comment();") 입력
        each val in comment
          #comment
            h5(style='display: inline; font-weight: bold; color: #1F50B5')= val.email
            h5(style='display: inline;') &nbsp;&nbsp;&nbsp;
            h5(style='display: inline;')= val.content
    #info-con.col-xs-12
      table.table
        if (product.code)
          tr
            th 품번
            td= product.code
        if (product.price)
          tr
            th 가격
            td= product.price
        if (product.category)
          tr
            th 카테고리
            td= product.category
        if (product.nation)  
          tr
            th 제조국
            td= product.nation
        if (product.size)  
          tr
            th 사이즈
            td= product.size
        if (product.material)  
          tr
            th 소재
            td= product.material
        if (product.waterproof)  
          tr
            th 방수
            td= product.waterproof
        if (product.gender)  
          tr
            th 성별
            td= product.gender
        if (product.description)  
          tr
            th 제품설명
            td= product.description


    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js')
    script(src='/bootstrap/js/bootstrap.min.js')
    script.
      var count=1;
      function change(num){
        var copy = count;
        count=num;
        if(copy==num);
        else if(count==1){
          document.getElementById('productInfo').style.backgroundColor='#ffffff';
          document.getElementById('productInfo').style.color='#ffa800';
          document.getElementById('info-con').style.display='none';
          document.getElementById('community').style.backgroundColor='#ffa800';
          document.getElementById('community').style.color='#ffffff';
          document.getElementById('community-con').style.display='block';
        }
        else{
          document.getElementById('community').style.backgroundColor='#ffffff';
          document.getElementById('community').style.color='#ffa800';
          document.getElementById('community-con').style.display='none';
          document.getElementById('productInfo').style.backgroundColor='#ffa800';
          document.getElementById('productInfo').style.color='#ffffff';
          document.getElementById('info-con').style.display='block';
        }
      }
      function heart(num){
        var i;
        var id;
        for(i=1;i<=num;i++){
          id='h'+i;
          document.getElementById(id).innerHTML="<img src='./images/star_on.png' width='18px')>";
        }
        for(i=num+1;i<=5;i++){
          id='h'+i;
          document.getElementById(id).innerHTML="<img src='./images/star.png' width='18px')>";
        }
        //document.getElementById('grade').innerHTML = num+'점';
      }
      function reg_comment(){
          $.ajax({
            type: "POST",
            url: '/reg_prod_comment',
            data: {productNo: #{productNo}, content: $("#commentField").val()},
            success: function() {
              location.reload();
            }
          });
        }
      function like(){
        var like_id = $('#like_img');
        if(like_id.attr('class') == "like"){
          $.ajax({
            type: "POST",
            url: '/product_like',
            data: {command: "delete", productNo: #{productNo}},
            success: function(data) {
              like_id.attr('class', 'no_like');
              like_id.attr('src', './images/heart.png');
              $('#like h6').html(data.count);
            }
          });
        }
        else{
         $.ajax({
            type: "POST",
            url: '/product_like',
            data: {command: "insert", productNo: #{productNo}},
            success: function(data) {
              like_id.attr('class', 'like');
              like_id.attr('src', './images/heart_on.png');
              $('#like h6').html(data.count);
            }
          });
        }
      }
      function clip(){
        var like_id = $('#clip_img');
        if(like_id.attr('class') == "clip"){
          $.ajax({
            type: "POST",
            url: '/product_clip',
            data: {command: "delete", productNo: #{productNo}},
            success: function(data) {
              like_id.attr('class', 'no_clip');
              like_id.attr('src', './images/clip.png');
              $('#clip h6').html(data.count);
            }
          });
        }
        else{
         $.ajax({
            type: "POST",
            url: '/product_clip',
            data: {command: "insert", productNo: #{productNo}},
            success: function(data) {
              like_id.attr('class', 'clip');
              like_id.attr('src', './images/clip_on.png');
              $('#clip h6').html(data.count);
            }
          });
        }
      }
